## [JSON 웹 토큰이란]

### (개념)

    - JWT(JSON 웹 토큰)는 JSON 개체로 당사자 간에 정보를 안전하게 전송하기 위한 작고 독립적인 방법을 정의하는 개방형 표준(RFC 7519)입니다.
    - 이 정보는 디지털 서명되어 있으므로 확인하고 신뢰할 수 있습니다. 
    - JWT는 비밀(HMAC 알고리즘 사용) 또는 RSA 또는 ECDSA를 사용하여 공개/개인 키 쌍을 사용하여 서명할 수 있습니다.
    - JWT는 당사자 간의 기밀성을 제공하기 위해 암호화 될 수 있지만 서명 된 토큰에 중점을 둘 것입니다. 
    - 서명된 토큰은 그 안에 포함된 정보와 무결성을 확인할 수 있으며, 암호화된 토큰은 다른 당사자로부터 해당 정보를 숨깁니다. 
    - 토큰이 공개/개인 키 쌍을 사용하여 서명되는 경우 서명은 개인 키를 보유한 당사자만 서명한 당사자임을 인증합니다.

### (필기)

    - JWT는 서명된 토큰에 중점을 둔다. = 내가 보낸 것이 좋다.
    - RSA나 HMAC알고리즘을 사용

## [JSON 웹 토큰은 언제 사용해야 합니까?]

### (개념)

1) 권한 부여 

- JWT 사용에 대한 가장 일반적인 시나리오입니다. 
- 사용자가 로그인하면 각 후속 요청에는 JWT가 포함되므로 사용자는 해당 토큰으로 허용되는 경로, 서비스 및 리소스에 액세스 할 수 있습니다. 
- 단일 사인온은 작은 오버 헤드와 다른 도메인에서 쉽게 사용할 수있는 기능 때문에 요즘 JWT를 널리 사용하는 기능입니다.

2) 정보 교환 : 
- JSON 웹 토큰은 당사자간에 정보를 안전하게 전송하는 좋은 방법입니다. 
- JWT는 공개/개인 키 쌍을 사용하는 등 서명할 수 있으므로 보낸 사람이 자신이 말하는 사람인지 확인할 수 있습니다. 
- 또한 헤더와 페이로드를 사용하여 서명을 계산할 때 콘텐츠가 변조되지 않았는지 확인할 수도 있습니다.

## [JSON 웹 토큰 구조]
    
    - xxxxx.yyyyy.zzzzz 총 3가지
    - 머리글
    - 페이로드(정보)
    - 서명

### (3가지의 종류)

  ### (1. 머리글)

    - 알고리즘의 유형
    - 타입 ex) JWT

  {

    "alg": "HS256",

    "typ": "JWT"

  }

  그런 다음이 JSON은 JWT의 첫 번째 부분을 형성하도록 Base64Url로 인코딩됩니다.

  Base64Url: 암호화도 할 수 있고 복호화도 할 수가 있다.

    cf. 헤싱: 암호화만 되고 복호화는 할 수가 없다.

  ### (2. 페이로드)

  - 토큰의 두 번째 부분은 정보가 포함된 페이로드입니다. 
  - 클레임은 엔터티(일반적으로 사용자) 및 추가 데이터에 대한 명령문입니다. 
  - 청구에는 등록, 공개 및 비공개 청구의 세 가지 유형이 있습니다.
  
      ### (종류)

       ### (1) 등록된 클레임(=정보)) 

        - 이러한 클레임은 필수는 아니지만 권장
        - __내용__--> iss (발행자), exp (만료 시간), 하위 (주제), aud (청중) 및 기타입니다.

       ### (2) 공개 클레임): 

        - 이들은 JWT를 사용하는 사람들에 의해 마음대로 정의될 수 있다. 
        - 그러나 충돌을 방지하려면 IANA JSON 웹 토큰 레지스트리에 정의하거나 충돌 방지 네임스페이스를 포함하는 URI로 정의해야 합니다.

       ### (3) 비공개(=개인) 클레임): 

        - 주로 유저정보를 여기에 넣는다. 
        - 이러한 클레임은 사용에 동의하는 당사자 간에 정보를 공유하기 위해 만들어진 사용자 지정 클레임이며 등록 또는 공개 클레임이 아닙니다.

        예를 들어 페이로드는 다음과 같습니다.

        {

          "sub": "1234567890", (등록된 클레임)

          "name": "John Doe", (등록된 클레임)

          "admin": true (개인 클래임)

        }

        - 페이로드는 JSON 웹 토큰의 두 번째 부분을 형성하도록 Base64Url로 인코딩됩니다.
        - 서명 된 토큰의 경우이 정보는 변조로부터 보호되지만 누구나 읽을 수 있습니다. 
        - 암호화되지 않는 한 JWT의 페이로드 또는 헤더 요소에 비밀 정보를 넣지 마십시오.

  ### (3. 서명)

  - 서명 부분을 만들려면 인코딩 된 헤더, 인코딩 된 페이로드, secret(키), 헤더에 지정된 알고리즘을 가져 와서 서명해야합니다.
  - 예를 들어 HMAC SHA256 알고리즘을 사용하려는 경우 서명은 다음과 같은 방식으로 작성됩니다.

  HMACSHA256(<-- 암호화

    base64UrlEncode(header) + "." +

    base64UrlEncode(payload),

    secret)

  - 서명은 메시지가 도중에 변경되지 않았 음을 확인하는 데 사용되며, 
  - 개인 키로 서명 된 토큰의 경우 JWT의 발신자가 자신이 말하는 사람인지 확인할 수도 있습니다.

(모든 것을 하나로 모으기)
- 출력은 HTML 및 HTTP 환경에서 쉽게 전달할 수 있는 점으로 구분된 세 개의 Base64 URL 문자열이며, SAML과 같은 XML 기반 표준과 비교할 때 더 컴팩트합니다.
- 다음은 이전 헤더와 페이로드가 인코딩되고 비밀로 서명된 JWT를 보여 줍니다. 인코딩된 JWT
- JWT를 사용하여 이러한 개념을 구현하려는 경우 디버거 jwt.io 사용하여 JWT를 디코딩, 확인 및 생성할 수 있습니다.

(JWT.io 디버거)

[JSON 웹 토큰 작동]

- 인증에서 사용자가 자격 증명을 사용하여 성공적으로 로그인하면 JSON 웹 토큰이 반환됩니다. 
- 토큰은 자격 증명이므로 보안 문제를 방지하기 위해 세심한주의를 기울여야합니다. 일반적으로 토큰을 필요 이상으로 오래 유지해서는 안 됩니다.
- 또한 보안 부족으로 인해 중요한 세션 데이터를 브라우저 저장소에 저장해서는 안 됩니다.
- 사용자가 보호된 경로 또는 리소스에 액세스하려고 할 때마다 사용자 에이전트는 일반적으로 Bearer 스키마를 사용하여 권한 부여 헤더에 JWT를 보내야 합니다. 
- 헤더의 내용은 다음과 같아야 합니다.

(Authorization: Bearer <token>)
  
- 이는 경우에 따라 상태 비저장 권한 부여 메커니즘일 수 있습니다. 
- 서버의 보호된 경로는 헤더에서 유효한 JWT를 확인하며, 있는 경우 사용자가 보호된 리소스에 액세스할 수 있습니다. 
- JWT에 필요한 데이터가 포함되어 있으면 특정 조작에 대해 데이터베이스를 쿼리해야 할 필요성이 줄어들 수 있지만 항상 그런 것은 아닙니다.Authorization

- HTTP 헤더를 통해 JWT 토큰을 보내는 경우 너무 커지지 않도록 해야 합니다. 일부 서버는 헤더에서 8KB 이상을 허용하지 않습니다.
- 모든 사용자의 권한을 포함하는 것과 같이 JWT 토큰에 너무 많은 정보를 포함하려는 경우 Auth0 세분화 된 권한 부여와 같은 대체 솔루션이 필요할 수 있습니다.
- 토큰이 헤더에 전송되는 경우 쿠키를 사용하지 않으므로 CORS(원본 간 리소스 공유)는 문제가 되지 않습니다.Authorization
- 다음 다이어그램은 JWT를 가져와 API 또는 자원에 액세스하는 데 사용하는 방법을 보여 줍니다.

[ JSON 웹 토큰은 어떻게 작동합니까?]

- 응용 프로그램 또는 클라이언트가 권한 부여 서버에 권한 부여를 요청합니다. 
- 이는 서로 다른 권한 부여 흐름 중 하나를 통해 수행됩니다. 
- 예를 들어 일반적인 OpenID Connect 호환 웹 응용 프로그램은 권한 부여 코드 흐름을 사용하여 끝점을 통과합니다./oauth/authorize
- 권한이 부여되면 권한 부여 서버는 응용 프로그램에 액세스 토큰을 반환합니다.
- 응용 프로그램은 액세스 토큰을 사용하여 보호된 리소스(예: API)에 액세스합니다.
- 서명된 토큰을 사용하면 토큰에 포함된 모든 정보가 사용자나 다른 당사자에게 노출되지만 변경할 수 없더라도 마찬가지입니다. 
- 즉, 토큰 내에 비밀 정보를 넣지 않아야합니다.

[JSON 웹 토큰을 사용해야하는 이유는 무엇입니까?]
  
단순 웹 토큰(SWT) 및 SAML(보안 어설션 마크업 언어 토큰)과 비교할 때 JSON 웹 토큰(JWT)의 이점에 대해 살펴보겠습니다.

JSON은 XML보다 덜 장황하기 때문에 인코딩 될 때 크기도 작아 JWT가 SAML보다 더 컴팩트합니다. 따라서 JWT는 HTML 및 HTTP 환경에서 전달할 수있는 좋은 선택입니다.

보안 측면에서 SWT는 HMAC 알고리즘을 사용하여 공유 비밀에 의해서만 대칭적으로 서명될 수 있습니다. 그러나 JWT 및 SAML 토큰은 서명에 X.509 인증서 형태로 공개/개인 키 쌍을 사용할 수 있습니다. 모호한 보안 허점을 도입하지 않고 XML 디지털 서명으로 XML에 서명하는 것은 JSON 서명의 단순성과 비교할 때 매우 어렵습니다.

JSON 파서는 객체에 직접 매핑되기 때문에 대부분의 프로그래밍 언어에서 일반적입니다. 반대로 XML에는 자연스러운 문서 대 개체 매핑이 없습니다. 따라서 SAML 어설션보다 JWT로 작업하기가 더 쉬워집니다.

사용과 관련하여 JWT는 인터넷 규모로 사용됩니다. 이는 여러 플랫폼, 특히 모바일에서 JSON 웹 토큰의 클라이언트 측 처리의 용이성을 강조합니다.

인코딩된 JWT와 인코딩된 SAML의 길이 비교 인코딩된 JWT와 인코딩된 SAML의 길이 비교

JSON 웹 토큰에 대해 자세히 알아보고 이를 사용하여 자체 응용 프로그램에서 인증을 수행하려면 Auth0에서 JSON 웹 토큰 방문 페이지로 이동합니다.
